<?php// 引数の処理if ($argc == 2){    $filename = $argv[1];    $hasTitleRow = false;}else if ($argc == 3 && $argv[1] === '-t') {    $filename = $argv[2];    $hasTitleRow = true;}else {    echo "Usage: php makeplist.php [-t] <filename>\n";    echo "  -t             The file has a title row.\n";    exit();}// ファイルオープンif (!file_exists($filename)) {    echo "No such file $filename\n";    exit();}$pos  = strrpos($filename, '.');$filename_out = substr($filename, 0, $pos).'.plist';$fp_in = fopen($filename, "r");$fp_out = fopen($filename_out, "w");// タイトル行を取得if ($hasTitleRow) {    $data = fgetcsv($fp_in, 1000, ",");    $num = count($data);    $keys = array();    for ($i = 0; $i < $num; $i++) {        $keys[$i] = $data[$i];    }}// plist生成fwrite($fp_out, "<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n");fwrite($fp_out, "<!DOCTYPE plist PUBLIC \"-//Apple//DTD PLIST 1.0//EN\" \"http://www.apple.com/DTDs/PropertyList-1.0.dtd\">\n");fwrite($fp_out, "<plist version=\"1.0\">\n");fwrite($fp_out, "<array>\n");fwrite($fp_out, "\t<dict>\n");$currentCharaId = 0;while ($data = fgetcsv($fp_in, 1000, ",")) {    $num = count($data);    $charaId = $data[0];        // 前の配列を閉じる    if (($currentCharaId != 0) && ($currentCharaId != $charaId)) {        fwrite($fp_out, "\t\t</array>\n");        fwrite($fp_out, "\t</dict>\n");        fwrite($fp_out, "\t<dict>\n");    }    if ($currentCharaId != $charaId) {        if ($hasTitleRow) {            fwrite($fp_out, "\t\t<key>$keys[0]</key>\n");        }        else {            fwrite($fp_out, "\t\t<key>keyname$0</key>\n");        }        fwrite($fp_out, "\t\t<string>".$charaId."</string>\n");        fwrite($fp_out, "\t\t<key>monsters</key>\n");        fwrite($fp_out, "\t\t<array>\n");    }            fwrite($fp_out, "\t\t\t<dict>\n");        for ($i = 1; $i < $num; $i++) {    	// 中身が空のデータは追加しない    	if ($data[$i] == "") {    		continue;    	}        if ($hasTitleRow) {            fwrite($fp_out, "\t\t\t\t<key>$keys[$i]</key>\n");        }        else {            fwrite($fp_out, "\t\t\t\t<key>keyname$i</key>\n");        }        fwrite($fp_out, "\t\t\t\t<string>".$data[$i]."</string>\n");    }    fwrite($fp_out, "\t\t\t</dict>\n");        $currentCharaId = $charaId;}fclose($fp_in);fwrite($fp_out, "\t\t</array>\n");fwrite($fp_out, "\t</dict>\n");fwrite($fp_out, "</array>\n");fwrite($fp_out, "</plist>\n");fclose($fp_out);echo "Generated:$filename_out\n";